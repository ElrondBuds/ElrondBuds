<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="origin" />
    <title>eBuds - Wallet</title>
    <link rel="stylesheet" href="styles.css" />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet" />
    <style>
        /* Asigurati-va ca aveti un fisier styles.css sau adaugati stilurile aici */
        :root {
            --dark-bg: #030014;
            --neon-green: #00ff9d;
            --highlight-color: #00ff9d;
            --text-color: #ffffff;
            --container-bg: rgba(10, 25, 47, 0.85);
            --border-color: var(--neon-green);
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('assets/background.jpg') no-repeat center center fixed; /* Adaugati o imagine de fundal daca doriti */
            background-size: cover;
            opacity: 0.1;
            z-index: -1;
        }

        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: hsl(var(--dark-bg, #030014));
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background-color: hsl(var(--neon-green, #00ff9d));
            border-radius: 10px;
            border: 3px solid hsl(var(--dark-bg, #030014));
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: hsl(var(--highlight-color, #00ff9d));
            filter: brightness(1.2);
        }

        html {
            scrollbar-width: thin;
            scrollbar-color: hsl(var(--neon-green, #00ff9d)) hsl(var(--dark-bg, #030014));
        }

        .wallet-nav {
            width: 100%;
            background-color: rgba(3, 0, 20, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .wallet-nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px 20px;
        }
        
        .nav-logo-wallet {
            height: 50px;
        }
        
        .wallet-nav-title {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-green);
            margin: 0;
            text-shadow: 0 0 5px var(--neon-green);
        }

        .nav-right-controls {
            display: flex;
            align-items: center;
        }
        
        .container-wrapper {
            width: 100%;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }

        .main-content-area {
            background: var(--container-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 15px rgba(0, 255, 157, 0.5);
        }
        
        h1, h2, h3 {
             font-family: 'Orbitron', sans-serif;
             color: var(--neon-green);
        }
        
        .wallet-options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .wallet-option {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .manual-option {
             grid-column: 1 / -1; /* Ocupa toata latimea */
        }

        .manual-input {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .manual-input input {
            flex-grow: 1;
            max-width: 400px;
        }

        input[type="text"], select {
            background-color: var(--dark-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 10px;
            border-radius: 5px;
        }
        
        .button-connect-wallet {
            font-family: 'Orbitron', sans-serif;
            background-color: transparent;
            color: var(--neon-green);
            border: 2px solid var(--neon-green);
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        
        .button-connect-wallet:hover {
            background-color: var(--neon-green);
            color: var(--dark-bg);
            box-shadow: 0 0 10px var(--neon-green);
        }

        .status-container {
            margin-top: 15px;
            min-height: 20px;
            color: var(--neon-green);
        }
        
        .error-message {
            color: #ff4d4d;
        }
        
        .wallet-info-container ul {
            list-style: none;
            padding: 0;
        }

        .wallet-info-container li {
            background-color: rgba(0, 255, 157, 0.1);
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 5px;
        }
        
        .back-link-container {
            text-align: center;
            margin-top: 30px;
        }
        
        .back-link {
            color: var(--neon-green);
            text-decoration: none;
            font-size: 1.1em;
        }

        .warning-icon {
            color: #ffcc00;
            cursor: help;
            font-style: normal;
        }
    </style>
</head>
<body>
    <div class="background-overlay"></div>
    <nav class="wallet-nav">
        <div class="wallet-nav-container">
            <a href="index.html" class="logo-link">
                <img src="assets/logo.png" alt="eBuds Logo" class="nav-logo-wallet">
            </a>
            <div class="nav-title-group">
                <h1 class="wallet-nav-title" data-translate-key="wallet_page_title">eBuds Wallet</h1>
            </div>
            <div class="nav-right-controls">
                <div class="language-selector-container">
                    <select id="language-selector-wallet" aria-label="Select Language">
                        <option value="en">EN</option>
                        <option value="ar">AR</option>
                        <option value="zh">ZH</option>
                        <option value="de">DE</option>
                        <option value="es">ES</option>
                        <option value="fr">FR</option>
                        <option value="it">IT</option>
                        <option value="ja">JA</option>
                        <option value="ko">KO</option>
                        <option value="ro">RO</option>
                    </select>
                </div>
                <button id="disconnectBtnNav" class="button-connect-wallet disconnect-button" data-translate-key="disconnect_button" style="display:none; margin-left: 10px;"></button>
            </div>
        </div>
    </nav>

    <div class="container-wrapper">
        <div class="main-content-area">
            <h1 data-translate-key="connect_info_title">Your Web3 Universe</h1>
            <div id="connectionOptions" style="display: block;">
                <div class="status-container" data-status-for="general"></div>
                <div class="wallet-options-grid">
                    <div class="wallet-option">
                        <h3 data-translate-key="xportal_mobile_title">üì± xPortal (Mobile)</h3>
                        <p data-translate-key="xportal_mobile_description">Connect via the mobile application.</p>
                        <div id="qr-code-container" style="margin: 10px auto; max-width: 250px;"></div>
                        <div class="status-container" data-status-for="mobile"></div>
                        <button id="mobileBtn" class="button-connect-wallet" data-translate-key="generate_qr_button">Generate QR</button>
                    </div>
                    <div class="wallet-option" id="extensionWalletOption">
                        <h3 data-translate-key="browser_extension_title">üîå Browser Extension</h3>
                        <p data-translate-key="browser_extension_description">Use the MultiversX browser extension.</p>
                        <div class="status-container" data-status-for="extension"></div>
                        <button id="extensionBtn" class="button-connect-wallet" data-translate-key="connect_extension_button">Connect Extension</button>
                    </div>
                </div>

                <div class="wallet-option manual-option">
                    <h3 data-translate-key="view_address_title">üëÅÔ∏è View Address</h3>
                    <p data-translate-key="view_address_description">Manually enter wallet address to view assets.</p>
                    <div class="manual-input">
                        <input type="text" id="manualAddressInput" placeholder="erd1..." />
                        <button id="manualAddressBtn" class="button-connect-wallet" data-translate-key="check_address_button">Check Address</button>
                    </div>
                    <div class="status-container" data-status-for="manual"></div>
                </div>
            </div>

            <div id="walletUI" style="display: none;">
                <div class="status-container" data-status-for="wallet-load"></div>
                <div id="walletDetails" class="wallet-info-container"></div>
            </div>

            <div class="back-link-container">
                <a href="index.html" class="back-link" data-translate-key="back_to_main_site">‚Üê Back to Main Site</a>
            </div>
        </div>
    </div>

    <script type="module">
    import { ElvenJS } from 'https://unpkg.com/elven.js@0.20.0/build/elven.js';

    const translations = {
        en: {
            wallet_page_title: "eBuds Wallet",
            connect_info_title: "Your Web3 Universe",
            xportal_mobile_title: "üì± xPortal (Mobile)",
            xportal_mobile_description: "Connect via the mobile application.",
            generate_qr_button: "Generate QR",
            browser_extension_title: "üîå Browser Extension",
            browser_extension_description: "Use the MultiversX browser extension.",
            connect_extension_button: "Connect Extension",
            view_address_title: "üëÅÔ∏è View Address",
            view_address_description: "Manually enter wallet address to view assets.",
            check_address_button: "Check Address",
            disconnect_button: "Disconnect",
            back_button: "Back",
            back_to_main_site: "‚Üê Back to Main Site",
            wallet_info_title: "Wallet Information",
            address_label: "Address:",
            egld_balance_label: "EGLD Balance:",
            vote_power_label: "Voting Power:",
            vote_power_desc: "(based on number of eBuds NFTs held)",
            assets_title: "Assets in Wallet",
            tokens_section_title: "ü™ô Tokens",
            nfts_section_title: "üñºÔ∏è NFT Collections",
            no_tokens_message: "You don't hold any tokens (excluding EGLD).",
            no_other_nfts_message: "You don't hold any other NFT collections.",
            loading_wallet_data: "Loading wallet data...",
            invalid_address: "Invalid wallet address",
            blockchain_error: "Error fetching data from blockchain",
            elven_init_error: "Error initializing ElvenJS",
            generating_qr: "Generating QR code...",
            qr_error: "Error generating QR code",
            connecting_extension: "Attempting to connect extension...",
            extension_error: "Error connecting extension",
            disconnecting: "Disconnecting...",
            disconnect_error: "Error disconnecting",
            invalid_manual_address: "The entered address is invalid.",
            connecting_init: "Initializing connection...",
            ebud_token_label: "EBUD Token",
            luv_token_label: "LUV Token",
            green_token_label: "GREEN Token",
            hit_token_label: "HIT Token",
            bud_collection_label: "eBuds Collection",
        },
        ar: {
            wallet_page_title: "ŸÖÿ≠ŸÅÿ∏ÿ© eBuds",
            connect_info_title: "ÿπÿßŸÑŸÖ Web3 ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ",
            xportal_mobile_title: "üì± xPortal (ŸÖŸàÿ®ÿßŸäŸÑ)",
            xportal_mobile_description: "ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿπÿ®ÿ± ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸáÿßÿ™ŸÅ ÿßŸÑŸÖÿ≠ŸÖŸàŸÑ.",
            generate_qr_button: "ÿ•ŸÜÿ¥ÿßÿ° ÿ±ŸÖÿ≤ QR",
            browser_extension_title: "üîå ÿßŸÖÿ™ÿØÿßÿØ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠",
            browser_extension_description: "ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÖÿ™ÿØÿßÿØ ŸÖÿ™ÿµŸÅÿ≠ MultiversX.",
            connect_extension_button: "ÿ±ÿ®ÿ∑ ÿßŸÑÿßŸÖÿ™ÿØÿßÿØ",
            view_address_title: "üëÅÔ∏è ÿπÿ±ÿ∂ ÿßŸÑÿπŸÜŸàÿßŸÜ",
            view_address_description: "ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ© ŸäÿØŸàŸäÿßŸã ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ£ÿµŸàŸÑ.",
            check_address_button: "ŸÅÿ≠ÿµ ÿßŸÑÿπŸÜŸàÿßŸÜ",
            disconnect_button: "ŸÇÿ∑ÿπ ÿßŸÑÿßÿ™ÿµÿßŸÑ",
            back_button: "ÿ±ÿ¨Ÿàÿπ",
            back_to_main_site: "‚Üê ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä",
            wallet_info_title: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©",
            address_label: "ÿßŸÑÿπŸÜŸàÿßŸÜ:",
            egld_balance_label: "ÿ±ÿµŸäÿØ EGLD:",
            vote_power_label: "ŸÇŸàÿ© ÿßŸÑÿ™ÿµŸàŸäÿ™:",
            vote_power_desc: "(ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿπÿØÿØ NFTs eBuds ÿßŸÑŸÖŸÖŸÑŸàŸÉÿ©)",
            assets_title: "ÿßŸÑÿ£ÿµŸàŸÑ ŸÅŸä ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©",
            tokens_section_title: "ü™ô ÿßŸÑÿ±ŸÖŸàÿ≤ ÿßŸÑŸÖŸÖŸäÿ≤ÿ©",
            nfts_section_title: "üñºÔ∏è ŸÖÿ¨ŸÖŸàÿπÿßÿ™ NFT",
            no_tokens_message: "ŸÑÿß ÿ™ŸÖŸÑŸÉ ÿ£Ÿä ÿ±ŸÖŸàÿ≤ ŸÖŸÖŸäÿ≤ÿ© (ÿ®ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° EGLD).",
            no_other_nfts_message: "ŸÑÿß ÿ™ŸÖŸÑŸÉ ÿ£Ÿä ŸÖÿ¨ŸÖŸàÿπÿßÿ™ NFT ÿ£ÿÆÿ±Ÿâ.",
            loading_wallet_data: "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©...",
            invalid_address: "ÿπŸÜŸàÿßŸÜ ŸÖÿ≠ŸÅÿ∏ÿ© ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠",
            blockchain_error: "ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ÿßŸÑÿ®ŸÑŸàŸÉ ÿ™ÿ¥ŸäŸÜ",
            elven_init_error: "ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸáŸäÿ¶ÿ© ElvenJS",
            generating_qr: "ÿ¨ÿßÿ±Ÿä ÿ•ŸÜÿ¥ÿßÿ° ÿ±ŸÖÿ≤ QR...",
            qr_error: "ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿ±ŸÖÿ≤ QR",
            connecting_extension: "ŸÖÿ≠ÿßŸàŸÑÿ© ÿ±ÿ®ÿ∑ ÿßŸÑÿßŸÖÿ™ÿØÿßÿØ...",
            extension_error: "ÿÆÿ∑ÿ£ ŸÅŸä ÿ±ÿ®ÿ∑ ÿßŸÑÿßŸÖÿ™ÿØÿßÿØ",
            disconnecting: "ÿ¨ÿßÿ±Ÿä ŸÇÿ∑ÿπ ÿßŸÑÿßÿ™ÿµÿßŸÑ...",
            disconnect_error: "ÿÆÿ∑ÿ£ ŸÅŸä ŸÇÿ∑ÿπ ÿßŸÑÿßÿ™ÿµÿßŸÑ",
            invalid_manual_address: "ÿßŸÑÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖÿØÿÆŸÑ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠.",
            connecting_init: "ÿ®ÿØÿ° ÿßŸÑÿßÿ™ÿµÿßŸÑ...",
            ebud_token_label: "ÿ±ŸÖÿ≤ EBUD",
            luv_token_label: "ÿ±ŸÖÿ≤ LUV",
            green_token_label: "ÿ±ŸÖÿ≤ GREEN",
            hit_token_label: "ÿ±ŸÖÿ≤ HIT",
            bud_collection_label: "ŸÖÿ¨ŸÖŸàÿπÿ© eBuds",
        },
        zh: {
            wallet_page_title: "eBuds Èí±ÂåÖ",
            connect_info_title: "ÊÇ®ÁöÑ Web3 ÂÆáÂÆô",
            xportal_mobile_title: "üì± xPortal (ÊâãÊú∫)",
            xportal_mobile_description: "ÈÄöËøáÊâãÊú∫Â∫îÁî®Á®ãÂ∫èËøûÊé•„ÄÇ",
            generate_qr_button: "ÁîüÊàê‰∫åÁª¥Á†Å",
            browser_extension_title: "üîå ÊµèËßàÂô®Êâ©Â±ï",
            browser_extension_description: "‰ΩøÁî® MultiversX ÊµèËßàÂô®Êâ©Â±ï„ÄÇ",
            connect_extension_button: "ËøûÊé•Êâ©Â±ï",
            view_address_title: "üëÅÔ∏è Êü•ÁúãÂú∞ÂùÄ",
            view_address_description: "ÊâãÂä®ËæìÂÖ•Èí±ÂåÖÂú∞ÂùÄ‰ª•Êü•ÁúãËµÑ‰∫ß„ÄÇ",
            check_address_button: "Ê£ÄÊü•Âú∞ÂùÄ",
            disconnect_button: "Êñ≠ÂºÄËøûÊé•",
            back_button: "ËøîÂõû",
            back_to_main_site: "‚Üê ËøîÂõû‰∏ªÁ´ô",
            wallet_info_title: "Èí±ÂåÖ‰ø°ÊÅØ",
            address_label: "Âú∞ÂùÄÔºö",
            egld_balance_label: "EGLD ‰ΩôÈ¢ùÔºö",
            vote_power_label: "ÊäïÁ•®ÊùÉÈáçÔºö",
            vote_power_desc: "ÔºàÂü∫‰∫éÊåÅÊúâÁöÑ eBuds NFT Êï∞ÈáèÔºâ",
            assets_title: "Èí±ÂåÖ‰∏≠ÁöÑËµÑ‰∫ß",
            tokens_section_title: "ü™ô ‰ª£Â∏Å",
            nfts_section_title: "üñºÔ∏è NFT Êî∂Ëóè",
            no_tokens_message: "ÊÇ®Ê≤°ÊúâÊåÅÊúâ‰ªª‰Ωï‰ª£Â∏ÅÔºàÈô§‰∫Ü EGLDÔºâ„ÄÇ",
            no_other_nfts_message: "ÊÇ®Ê≤°ÊúâÊåÅÊúâÂÖ∂‰ªñ NFT Êî∂Ëóè„ÄÇ",
            loading_wallet_data: "Ê≠£Âú®Âä†ËΩΩÈí±ÂåÖÊï∞ÊçÆ...",
            invalid_address: "Êó†ÊïàÁöÑÈí±ÂåÖÂú∞ÂùÄ",
            blockchain_error: "‰ªéÂå∫ÂùóÈìæËé∑ÂèñÊï∞ÊçÆÊó∂Âá∫Èîô",
            elven_init_error: "ÂàùÂßãÂåñ ElvenJS Êó∂Âá∫Èîô",
            generating_qr: "Ê≠£Âú®ÁîüÊàê‰∫åÁª¥Á†Å...",
            qr_error: "ÁîüÊàê‰∫åÁª¥Á†ÅÊó∂Âá∫Èîô",
            connecting_extension: "Ê≠£Âú®Â∞ùËØïËøûÊé•Êâ©Â±ï...",
            extension_error: "ËøûÊé•Êâ©Â±ïÊó∂Âá∫Èîô",
            disconnecting: "Ê≠£Âú®Êñ≠ÂºÄËøûÊé•...",
            disconnect_error: "Êñ≠ÂºÄËøûÊé•Êó∂Âá∫Èîô",
            invalid_manual_address: "ËæìÂÖ•ÁöÑÂú∞ÂùÄÊó†Êïà„ÄÇ",
            connecting_init: "Ê≠£Âú®ÂàùÂßãÂåñËøûÊé•...",
            ebud_token_label: "EBUD ‰ª£Â∏Å",
            luv_token_label: "LUV ‰ª£Â∏Å",
            green_token_label: "GREEN ‰ª£Â∏Å",
            hit_token_label: "HIT ‰ª£Â∏Å",
            bud_collection_label: "eBuds Êî∂Ëóè",
        },
        de: {
            wallet_page_title: "eBuds Wallet",
            connect_info_title: "Ihr Web3-Universum",
            xportal_mobile_title: "üì± xPortal (Mobil)",
            xportal_mobile_description: "√úber die mobile Anwendung verbinden.",
            generate_qr_button: "QR-Code generieren",
            browser_extension_title: "üîå Browser-Erweiterung",
            browser_extension_description: "Verwenden Sie die MultiversX Browser-Erweiterung.",
            connect_extension_button: "Erweiterung verbinden",
            view_address_title: "üëÅÔ∏è Adresse anzeigen",
            view_address_description: "Wallet-Adresse manuell eingeben, um Assets anzuzeigen.",
            check_address_button: "Adresse pr√ºfen",
            disconnect_button: "Trennen",
            back_button: "Zur√ºck",
            back_to_main_site: "‚Üê Zur√ºck zur Hauptseite",
            wallet_info_title: "Wallet-Informationen",
            address_label: "Adresse:",
            egld_balance_label: "EGLD-Guthaben:",
            vote_power_label: "Abstimmungsmacht:",
            vote_power_desc: "(basierend auf der Anzahl der gehaltenen eBuds NFTs)",
            assets_title: "Assets im Wallet",
            tokens_section_title: "ü™ô Token",
            nfts_section_title: "üñºÔ∏è NFT-Sammlungen",
            no_tokens_message: "Sie besitzen keine Token (au√üer EGLD).",
            no_other_nfts_message: "Sie besitzen keine anderen NFT-Sammlungen.",
            loading_wallet_data: "Wallet-Daten werden geladen...",
            invalid_address: "Ung√ºltige Wallet-Adresse",
            blockchain_error: "Fehler beim Abrufen der Blockchain-Daten",
            elven_init_error: "Fehler beim Initialisieren von ElvenJS",
            generating_qr: "QR-Code wird generiert...",
            qr_error: "Fehler beim Generieren des QR-Codes",
            connecting_extension: "Verbindung zur Erweiterung wird versucht...",
            extension_error: "Fehler beim Verbinden der Erweiterung",
            disconnecting: "Verbindung wird getrennt...",
            disconnect_error: "Fehler beim Trennen",
            invalid_manual_address: "Die eingegebene Adresse ist ung√ºltig.",
            connecting_init: "Verbindung wird initialisiert...",
            ebud_token_label: "EBUD Token",
            luv_token_label: "LUV Token",
            green_token_label: "GREEN Token",
            hit_token_label: "HIT Token",
            bud_collection_label: "eBuds Sammlung",
        },
        es: {
            wallet_page_title: "Cartera eBuds",
            connect_info_title: "Tu Universo Web3",
            xportal_mobile_title: "üì± xPortal (M√≥vil)",
            xportal_mobile_description: "Conectar a trav√©s de la aplicaci√≥n m√≥vil.",
            generate_qr_button: "Generar QR",
            browser_extension_title: "üîå Extensi√≥n del Navegador",
            browser_extension_description: "Usa la extensi√≥n del navegador MultiversX.",
            connect_extension_button: "Conectar Extensi√≥n",
            view_address_title: "üëÅÔ∏è Ver Direcci√≥n",
            view_address_description: "Introduce manually la direcci√≥n de la cartera para ver los activos.",
            check_address_button: "Verificar Direcci√≥n",
            disconnect_button: "Desconectar",
            back_button: "Atr√°s",
            back_to_main_site: "‚Üê Volver al Sitio Principal",
            wallet_info_title: "Informaci√≥n de la Cartera",
            address_label: "Direcci√≥n:",
            egld_balance_label: "Saldo EGLD:",
            vote_power_label: "Poder de Voto:",
            vote_power_desc: "(basado en el n√∫mero de NFTs eBuds que posees)",
            assets_title: "Activos en la Cartera",
            tokens_section_title: "ü™ô Tokens",
            nfts_section_title: "üñºÔ∏è Colecciones NFT",
            no_tokens_message: "No posees ning√∫n token (excluyendo EGLD).",
            no_other_nfts_message: "No posees otras colecciones NFT.",
            loading_wallet_data: "Cargando datos de la cartera...",
            invalid_address: "Direcci√≥n de cartera inv√°lida",
            blockchain_error: "Error al obtener datos de la blockchain",
            elven_init_error: "Error al inicializar ElvenJS",
            generating_qr: "Generando c√≥digo QR...",
            qr_error: "Error al generar c√≥digo QR",
            connecting_extension: "Intentando conectar extensi√≥n...",
            extension_error: "Error al conectar extensi√≥n",
            disconnecting: "Desconectando...",
            disconnect_error: "Error al desconectar",
            invalid_manual_address: "La direcci√≥n introducida no es v√°lida.",
            connecting_init: "Inicializando conexi√≥n...",
            ebud_token_label: "Token EBUD",
            luv_token_label: "Token LUV",
            green_token_label: "Token GREEN",
            hit_token_label: "Token HIT",
            bud_collection_label: "Colecci√≥n eBuds",
        },
        fr: {
            wallet_page_title: "Portefeuille eBuds",
            connect_info_title: "Votre Univers Web3",
            xportal_mobile_title: "üì± xPortal (Mobile)",
            xportal_mobile_description: "Se connecter via l'application mobile.",
            generate_qr_button: "G√©n√©rer QR",
            browser_extension_title: "üîå Extension de Navigateur",
            browser_extension_description: "Utilisez l'extension de navigateur MultiversX.",
            connect_extension_button: "Connecter Extension",
            view_address_title: "üëÅÔ∏è Voir l'Adresse",
            view_address_description: "Entrez manuellement l'adresse du portefeuille pour voir les actifs.",
            check_address_button: "V√©rifier l'Adresse",
            disconnect_button: "D√©connecter",
            back_button: "Retour",
            back_to_main_site: "‚Üê Retour au Site Principal",
            wallet_info_title: "Informations du Portefeuille",
            address_label: "Adresse :",
            egld_balance_label: "Solde EGLD :",
            vote_power_label: "Pouvoir de Vote :",
            vote_power_desc: "(bas√© sur le nombre de NFTs eBuds d√©tenus)",
            assets_title: "Actifs dans le Portefeuille",
            tokens_section_title: "ü™ô Tokens",
            nfts_section_title: "üñºÔ∏è Collections NFT",
            no_tokens_message: "Vous ne d√©tenez aucun token (hors EGLD).",
            no_other_nfts_message: "Vous ne d√©tenez aucune autre collection NFT.",
            loading_wallet_data: "Chargement des donn√©es du portefeuille...",
            invalid_address: "Adresse de portefeuille invalide",
            blockchain_error: "Erreur lors de la r√©cup√©ration des donn√©es de la blockchain",
            elven_init_error: "Erreur lors de l'initialisation d'ElvenJS",
            generating_qr: "G√©n√©ration du code QR...",
            qr_error: "Erreur lors de la g√©n√©ration du code QR",
            connecting_extension: "Tentative de connexion de l'extension...",
            extension_error: "Erreur lors de la connexion de l'extension",
            disconnecting: "D√©connexion...",
            disconnect_error: "Erreur lors de la d√©connexion",
            invalid_manual_address: "L'adresse saisie n'est pas valide.",
            connecting_init: "Initialisation de la connexion...",
            ebud_token_label: "Token EBUD",
            luv_token_label: "Token LUV",
            green_token_label: "Token GREEN",
            hit_token_label: "Token HIT",
            bud_collection_label: "Collection eBuds",
        },
        it: {
            wallet_page_title: "Portafoglio eBuds",
            connect_info_title: "Il Tuo Universo Web3",
            xportal_mobile_title: "üì± xPortal (Mobile)",
            xportal_mobile_description: "Connetti tramite l'applicazione mobile.",
            generate_qr_button: "Genera QR",
            browser_extension_title: "üîå Estensione del Browser",
            browser_extension_description: "Usa l'estensione del browser MultiversX.",
            connect_extension_button: "Connetti Estensione",
            view_address_title: "üëÅÔ∏è Visualizza Indirizzo",
            view_address_description: "Inserisci manualmente l'indirizzo del portafoglio per visualizzare gli asset.",
            check_address_button: "Verifica Indirizzo",
            disconnect_button: "Disconnetti",
            back_button: "Indietro",
            back_to_main_site: "‚Üê Torna al Sito Principale",
            wallet_info_title: "Informazioni Portafoglio",
            address_label: "Indirizzo:",
            egld_balance_label: "Saldo EGLD:",
            vote_power_label: "Potere di Voto:",
            vote_power_desc: "(basato sul numero di NFT eBuds posseduti)",
            assets_title: "Asset nel Portafoglio",
            tokens_section_title: "ü™ô Token",
            nfts_section_title: "üñºÔ∏è Collezioni NFT",
            no_tokens_message: "Non possiedi alcun token (escluso EGLD).",
            no_other_nfts_message: "Non possiedi altre collezioni NFT.",
            loading_wallet_data: "Caricamento dati portafoglio...",
            invalid_address: "Indirizzo portafoglio non valido",
            blockchain_error: "Errore nel recupero dati dalla blockchain",
            elven_init_error: "Errore nell'inizializzazione di ElvenJS",
            generating_qr: "Generazione codice QR...",
            qr_error: "Errore nella generazione del codice QR",
            connecting_extension: "Tentativo di connessione estensione...",
            extension_error: "Errore nella connessione dell'estensione",
            disconnecting: "Disconnessione...",
            disconnect_error: "Errore nella disconnessione",
            invalid_manual_address: "L'indirizzo inserito non √® valido.",
            connecting_init: "Inizializzazione connessione...",
            ebud_token_label: "Token EBUD",
            luv_token_label: "Token LUV",
            green_token_label: "Token GREEN",
            hit_token_label: "Token HIT",
            bud_collection_label: "Collezione eBuds",
        },
        ja: {
            wallet_page_title: "eBuds „Ç¶„Ç©„É¨„ÉÉ„Éà",
            connect_info_title: "„ÅÇ„Å™„Åü„ÅÆWeb3„É¶„Éã„Éê„Éº„Çπ",
            xportal_mobile_title: "üì± xPortal („É¢„Éê„Ç§„É´)",
            xportal_mobile_description: "„É¢„Éê„Ç§„É´„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÁµåÁî±„ÅßÊé•Á∂ö„ÄÇ",
            generate_qr_button: "QRÁîüÊàê",
            browser_extension_title: "üîå „Éñ„É©„Ç¶„Ç∂Êã°ÂºµÊ©üËÉΩ",
            browser_extension_description: "MultiversX„Éñ„É©„Ç¶„Ç∂Êã°ÂºµÊ©üËÉΩ„Çí‰ΩøÁî®„ÄÇ",
            connect_extension_button: "Êã°ÂºµÊ©üËÉΩ„ÇíÊé•Á∂ö",
            view_address_title: "üëÅÔ∏è „Ç¢„Éâ„É¨„ÇπË°®Á§∫",
            view_address_description: "„Ç¶„Ç©„É¨„ÉÉ„Éà„Ç¢„Éâ„É¨„Çπ„ÇíÊâãÂãï„ÅßÂÖ•Âäõ„Åó„Å¶„Ç¢„Çª„ÉÉ„Éà„ÇíË°®Á§∫„ÄÇ",
            check_address_button: "„Ç¢„Éâ„É¨„ÇπÁ¢∫Ë™ç",
            disconnect_button: "ÂàáÊñ≠",
            back_button: "Êàª„Çã",
            back_to_main_site: "‚Üê „É°„Ç§„É≥„Çµ„Ç§„Éà„Å´Êàª„Çã",
            wallet_info_title: "„Ç¶„Ç©„É¨„ÉÉ„ÉàÊÉÖÂ†±",
            address_label: "„Ç¢„Éâ„É¨„ÇπÔºö",
            egld_balance_label: "EGLDÊÆãÈ´òÔºö",
            vote_power_label: "ÊäïÁ•®Ê®©Ôºö",
            vote_power_desc: "Ôºà‰øùÊúâ„Åô„ÇãeBuds NFT„ÅÆÊï∞„Å´Âü∫„Å•„ÅèÔºâ",
            assets_title: "„Ç¶„Ç©„É¨„ÉÉ„ÉàÂÜÖ„ÅÆ„Ç¢„Çª„ÉÉ„Éà",
            tokens_section_title: "ü™ô „Éà„Éº„ÇØ„É≥",
            nfts_section_title: "üñºÔ∏è NFT„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥",
            no_tokens_message: "„Éà„Éº„ÇØ„É≥„Çí‰øùÊúâ„Åó„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºàEGLD„ÇíÈô§„ÅèÔºâ„ÄÇ",
            no_other_nfts_message: "‰ªñ„ÅÆNFT„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„Çí‰øùÊúâ„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ",
            loading_wallet_data: "„Ç¶„Ç©„É¨„ÉÉ„Éà„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...",
            invalid_address: "ÁÑ°Âäπ„Å™„Ç¶„Ç©„É¨„ÉÉ„Éà„Ç¢„Éâ„É¨„Çπ",
            blockchain_error: "„Éñ„É≠„ÉÉ„ÇØ„ÉÅ„Çß„Éº„É≥„Åã„Çâ„ÅÆ„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº",
            elven_init_error: "ElvenJS„ÅÆÂàùÊúüÂåñ„Ç®„É©„Éº",
            generating_qr: "QR„Ç≥„Éº„Éâ„ÇíÁîüÊàê‰∏≠...",
            qr_error: "QR„Ç≥„Éº„ÉâÁîüÊàê„Ç®„É©„Éº",
            connecting_extension: "Êã°ÂºµÊ©üËÉΩ„ÅÆÊé•Á∂ö„ÇíË©¶Ë°å‰∏≠...",
            extension_error: "Êã°ÂºµÊ©üËÉΩÊé•Á∂ö„Ç®„É©„Éº",
            disconnecting: "ÂàáÊñ≠‰∏≠...",
            disconnect_error: "ÂàáÊñ≠„Ç®„É©„Éº",
            invalid_manual_address: "ÂÖ•Âäõ„Åï„Çå„Åü„Ç¢„Éâ„É¨„Çπ„ÅåÁÑ°Âäπ„Åß„Åô„ÄÇ",
            connecting_init: "Êé•Á∂ö„ÇíÂàùÊúüÂåñ‰∏≠...",
            ebud_token_label: "EBUD„Éà„Éº„ÇØ„É≥",
            luv_token_label: "LUV„Éà„Éº„ÇØ„É≥",
            green_token_label: "GREEN„Éà„Éº„ÇØ„É≥",
            hit_token_label: "HIT„Éà„Éº„ÇØ„É≥",
            bud_collection_label: "eBuds„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥",
        },
        ko: {
            wallet_page_title: "eBuds ÏßÄÍ∞ë",
            connect_info_title: "ÎãπÏã†Ïùò Web3 Ïú†ÎãàÎ≤ÑÏä§",
            xportal_mobile_title: "üì± xPortal (Î™®Î∞îÏùº)",
            xportal_mobile_description: "Î™®Î∞îÏùº Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ ÌÜµÌï¥ Ïó∞Í≤∞Ìï©ÎãàÎã§.",
            generate_qr_button: "QR ÏÉùÏÑ±",
            browser_extension_title: "üîå Î∏åÎùºÏö∞Ï†Ä ÌôïÏû• ÌîÑÎ°úÍ∑∏Îû®",
            browser_extension_description: "MultiversX Î∏åÎùºÏö∞Ï†Ä ÌôïÏû• ÌîÑÎ°úÍ∑∏Îû®ÏùÑ ÏÇ¨Ïö©Ìï©ÎãàÎã§.",
            connect_extension_button: "ÌôïÏû• ÌîÑÎ°úÍ∑∏Îû® Ïó∞Í≤∞",
            view_address_title: "üëÅÔ∏è Ï£ºÏÜå Î≥¥Í∏∞",
            view_address_description: "ÏßÄÍ∞ë Ï£ºÏÜåÎ•º ÏàòÎèôÏúºÎ°ú ÏûÖÎ†•ÌïòÏó¨ ÏûêÏÇ∞ÏùÑ ÌôïÏù∏Ìï©ÎãàÎã§.",
            check_address_button: "Ï£ºÏÜå ÌôïÏù∏",
            disconnect_button: "Ïó∞Í≤∞ Ìï¥Ï†ú",
            back_button: "Îí§Î°ú",
            back_to_main_site: "‚Üê Î©îÏù∏ ÏÇ¨Ïù¥Ìä∏Î°ú ÎèåÏïÑÍ∞ÄÍ∏∞",
            wallet_info_title: "ÏßÄÍ∞ë Ï†ïÎ≥¥",
            address_label: "Ï£ºÏÜå:",
            egld_balance_label: "EGLD ÏûîÏï°:",
            vote_power_label: "Ìà¨ÌëúÍ∂å:",
            vote_power_desc: "(Î≥¥Ïú†Ìïú eBuds NFT ÏàòÏóê Í∏∞Î∞ò)",
            assets_title: "ÏßÄÍ∞ë ÎÇ¥ ÏûêÏÇ∞",
            tokens_section_title: "ü™ô ÌÜ†ÌÅ∞",
            nfts_section_title: "üñºÔ∏è NFT Ïª¨Î†âÏÖò",
            no_tokens_message: "Î≥¥Ïú†Ìïú ÌÜ†ÌÅ∞Ïù¥ ÏóÜÏäµÎãàÎã§(EGLD Ï†úÏô∏).",
            no_other_nfts_message: "Î≥¥Ïú†Ìïú Îã§Î•∏ NFT Ïª¨Î†âÏÖòÏù¥ ÏóÜÏäµÎãàÎã§.",
            loading_wallet_data: "ÏßÄÍ∞ë Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...",
            invalid_address: "ÏûòÎ™ªÎêú ÏßÄÍ∞ë Ï£ºÏÜå",
            blockchain_error: "Î∏îÎ°ùÏ≤¥Ïù∏ÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ Ïò§Î•ò",
            elven_init_error: "ElvenJS Ï¥àÍ∏∞Ìôî Ïò§Î•ò",
            generating_qr: "QR ÏΩîÎìú ÏÉùÏÑ± Ï§ë...",
            qr_error: "QR ÏΩîÎìú ÏÉùÏÑ± Ïò§Î•ò",
            connecting_extension: "ÌôïÏû• ÌîÑÎ°úÍ∑∏Îû® Ïó∞Í≤∞ ÏãúÎèÑ Ï§ë...",
            extension_error: "ÌôïÏû• ÌîÑÎ°úÍ∑∏Îû® Ïó∞Í≤∞ Ïò§Î•ò",
            disconnecting: "Ïó∞Í≤∞ Ìï¥Ï†ú Ï§ë...",
            disconnect_error: "Ïó∞Í≤∞ Ìï¥Ï†ú Ïò§Î•ò",
            invalid_manual_address: "ÏûÖÎ†•Ìïú Ï£ºÏÜåÍ∞Ä ÏûòÎ™ªÎêòÏóàÏäµÎãàÎã§.",
            connecting_init: "Ïó∞Í≤∞ Ï¥àÍ∏∞Ìôî Ï§ë...",
            ebud_token_label: "EBUD ÌÜ†ÌÅ∞",
            luv_token_label: "LUV ÌÜ†ÌÅ∞",
            green_token_label: "GREEN ÌÜ†ÌÅ∞",
            hit_token_label: "HIT ÌÜ†ÌÅ∞",
            bud_collection_label: "eBuds Ïª¨Î†âÏÖò",
        },
        ro: {
            wallet_page_title: "Portofel eBuds",
            connect_info_title: "Universul tƒÉu Web3",
            xportal_mobile_title: "üì± xPortal (Mobil)",
            xportal_mobile_description: "ConecteazƒÉ-te prin aplica»õia mobilƒÉ.",
            generate_qr_button: "GenereazƒÉ QR",
            browser_extension_title: "üîå Extensie de Browser",
            browser_extension_description: "Folose»ôte extensia de browser MultiversX.",
            connect_extension_button: "ConecteazƒÉ Extensia",
            view_address_title: "üëÅÔ∏è VizualizeazƒÉ Adresa",
            view_address_description: "Introdu manual adresa portofelului pentru a vedea activele.",
            check_address_button: "VerificƒÉ Adresa",
            disconnect_button: "DeconecteazƒÉ",
            back_button: "√énapoi",
            back_to_main_site: "‚Üê √énapoi la Site-ul Principal",
            wallet_info_title: "Informa»õii Portofel",
            address_label: "AdresƒÉ:",
            egld_balance_label: "Sold EGLD:",
            vote_power_label: "Putere de Vot:",
            vote_power_desc: "(bazatƒÉ pe numƒÉrul de NFT-uri eBuds de»õinute)",
            assets_title: "Active √Æn Portofel",
            tokens_section_title: "ü™ô Jetoane",
            nfts_section_title: "üñºÔ∏è Colec»õii NFT",
            no_tokens_message: "Nu de»õii niciun jeton (excluz√¢nd EGLD).",
            no_other_nfts_message: "Nu de»õii nicio altƒÉ colec»õie NFT.",
            loading_wallet_data: "Se √ÆncarcƒÉ datele portofelului...",
            invalid_address: "AdresƒÉ de portofel invalidƒÉ",
            blockchain_error: "Eroare la preluarea datelor de pe blockchain",
            elven_init_error: "Eroare la ini»õializarea ElvenJS",
            generating_qr: "Se genereazƒÉ codul QR...",
            qr_error: "Eroare la generarea codului QR",
            connecting_extension: "Se √ÆncearcƒÉ conectarea extensiei...",
            extension_error: "Eroare la conectarea extensiei",
            disconnecting: "Deconectare...",
            disconnect_error: "Eroare la deconectare",
            invalid_manual_address: "Adresa introdusƒÉ nu este validƒÉ.",
            connecting_init: "Se ini»õializeazƒÉ conexiunea...",
            ebud_token_label: "Jeton EBUD",
            luv_token_label: "Jeton LUV",
            green_token_label: "Jeton GREEN",
            hit_token_label: "Jeton HIT",
            bud_collection_label: "Colec»õia eBuds",
        }
    };

    const elvenJs = ElvenJS.init({
        apiUrl: "https://api.multiversx.com",
        chain: "mainnet"
    });

    const connectionOptions = document.getElementById('connectionOptions');
    const walletUI = document.getElementById('walletUI');
    const walletDetails = document.getElementById('walletDetails');
    const disconnectBtnNav = document.getElementById('disconnectBtnNav');
    
    const mobileBtn = document.getElementById('mobileBtn');
    const extensionBtn = document.getElementById('extensionBtn');
    const manualAddressBtn = document.getElementById('manualAddressBtn');
    const manualAddressInput = document.getElementById('manualAddressInput');
    const qrCodeContainer = document.getElementById('qr-code-container');
    const languageSelector = document.getElementById('language-selector-wallet');

    const ebudCollectionId = "EBUDS-158957"; // ID-ul colec»õiei eBuds NFT
    const trackedTokens = ["EBUD-4a6c4c", "LUV-ea581e", "GREEN-989f92", "HIT-0a256a"];

    const setStatus = (message, type = 'general', isError = false) => {
        const container = document.querySelector(`.status-container[data-status-for="${type}"]`);
        if (container) {
            container.innerHTML = `<p class="${isError ? 'error-message' : ''}">${message}</p>`;
        }
    };

    const updateUIForLanguage = (lang) => {
        document.querySelectorAll('[data-translate-key]').forEach(el => {
            const key = el.getAttribute('data-translate-key');
            if (translations[lang] && translations[lang][key]) {
                const text = translations[lang][key];
                if (el.tagName === 'BUTTON' || (el.tagName === 'P' && !el.querySelector('i'))) {
                    el.textContent = text;
                } else {
                     el.innerHTML = text; // Permite HTML simplu, cum ar fi emoji
                }
            } else if (translations['en'] && translations['en'][key]) {
                 el.innerHTML = translations['en'][key];
            }
        });
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    };

    const displayWalletData = async (address) => {
        const lang = languageSelector.value;
        setStatus(translations[lang].loading_wallet_data || 'Loading wallet data...', 'wallet-load');
        connectionOptions.style.display = 'none';
        walletUI.style.display = 'block';

        try {
            const account = await elvenJs.getAccount(address);
            const nfts = await elvenJs.getNFTs(address);
            const tokens = await elvenJs.getTokens(address);

            const egldBalance = (account.balance / Math.pow(10, 18)).toFixed(4);
            const ebudsNfts = nfts.filter(nft => nft.collection === ebudCollectionId);
            const votingPower = ebudsNfts.length;

            let tokensHtml = trackedTokens.map(tokenId => {
                const token = tokens.find(t => t.identifier === tokenId);
                const balance = token ? (token.balance / Math.pow(10, token.decimals || 18)).toLocaleString() : '0';
                const labelKey = `${tokenId.split('-')[0].toLowerCase()}_token_label`;
                return `<li>${translations[lang][labelKey] || tokenId}: <strong>${balance}</strong></li>`;
            }).join('');

            if (tokensHtml.trim() === '') {
                tokensHtml = `<p>${translations[lang].no_tokens_message || 'No tokens held.'}</p>`;
            }
            
            let nftsHtml = ebudsNfts.length > 0 ? `<li>${translations[lang].bud_collection_label || 'eBuds Collection'}: <strong>${ebudsNfts.length}</strong></li>` : '';
            const otherNfts = nfts.filter(nft => nft.collection !== ebudCollectionId);
            if(otherNfts.length === 0 && ebudsNfts.length === 0){
                 nftsHtml += `<p>${translations[lang].no_other_nfts_message || 'No other NFT collections held.'}</p>`;
            }

            walletDetails.innerHTML = `
                <h2>${translations[lang].wallet_info_title}</h2>
                <p><strong>${translations[lang].address_label}</strong> <a href="https://explorer.multiversx.com/accounts/${address}" target="_blank">${address.substring(0, 8)}...${address.substring(address.length - 8)}</a></p>
                <p><strong>${translations[lang].egld_balance_label}</strong> ${egldBalance} EGLD</p>
                <p><strong>${translations[lang].vote_power_label}</strong> ${votingPower} <i class="warning-icon" title="${translations[lang].vote_power_desc}">‚ìò</i></p>
                <hr>
                <h3>${translations[lang].assets_title}</h3>
                <h4>${translations[lang].tokens_section_title}</h4>
                <ul>${tokensHtml}</ul>
                <h4>${translations[lang].nfts_section_title}</h4>
                <ul>${nftsHtml}</ul>
            `;
            setStatus('', 'wallet-load');
        } catch (e) {
            console.error("Error fetching wallet data: ", e);
            setStatus(translations[lang].blockchain_error || 'Error fetching data from blockchain', 'wallet-load', true);
        }
    };

    const handleLogin = (address) => {
        localStorage.setItem('walletAddress', address);
        displayWalletData(address);
        disconnectBtnNav.style.display = 'block';
    };
    
    const handleLogout = () => {
        elvenJs.logout();
        localStorage.removeItem('walletAddress');
        walletUI.style.display = 'none';
        connectionOptions.style.display = 'block';
        disconnectBtnNav.style.display = 'none';
        walletDetails.innerHTML = '';
        qrCodeContainer.innerHTML = '';
        setStatus('', 'general');
    };

    mobileBtn.addEventListener('click', async () => {
        const lang = languageSelector.value;
        setStatus(translations[lang].generating_qr || 'Generating QR code...', 'mobile');
        qrCodeContainer.innerHTML = ''; 
        try {
            await elvenJs.login({
                provider: 'xportal',
                // Asigurati-va ca callbackUrl este corect in productie
                callbackUrl: window.location.href, 
                qrCodeContainer: qrCodeContainer
            });
            setStatus('', 'mobile');
            elvenJs.on('login', (address) => {
                handleLogin(address);
            });
             elvenJs.on('logout', () => {
                handleLogout();
            });
        } catch (e) {
            console.error("QR code generation error: ", e);
            setStatus(translations[lang].qr_error || 'Error generating QR code', 'mobile', true);
        }
    });

    extensionBtn.addEventListener('click', async () => {
        const lang = languageSelector.value;
        setStatus(translations[lang].connecting_extension || 'Attempting to connect extension...', 'extension');
        try {
            const address = await elvenJs.login({ provider: 'extension' });
            if (address) {
                handleLogin(address);
            }
        } catch (e) {
            console.error("Extension connection error: ", e);
            setStatus(translations[lang].extension_error || 'Error connecting extension', 'extension', true);
        }
    });

    manualAddressBtn.addEventListener('click', () => {
        const lang = languageSelector.value;
        const address = manualAddressInput.value.trim();
        if (address && address.startsWith('erd1') && address.length === 62) {
            setStatus('', 'manual');
            displayWalletData(address);
            disconnectBtnNav.style.display = 'none'; // Nu afisam buton de logout pentru adrese manuale
        } else {
            setStatus(translations[lang].invalid_manual_address || 'The entered address is invalid.', 'manual', true);
        }
    });

    disconnectBtnNav.addEventListener('click', () => {
        handleLogout();
    });

    languageSelector.addEventListener('change', (e) => {
        const lang = e.target.value;
        localStorage.setItem('preferredLanguage', lang);
        updateUIForLanguage(lang);
        const loggedInAddress = localStorage.getItem('walletAddress');
        const isManualAddress = walletUI.style.display === 'block' && !loggedInAddress;
        
        if (loggedInAddress) {
            displayWalletData(loggedInAddress);
        } else if (isManualAddress && manualAddressInput.value) {
             displayWalletData(manualAddressInput.value.trim());
        }
    });

    // La incarcarea paginii
    document.addEventListener('DOMContentLoaded', () => {
        const preferredLanguage = localStorage.getItem('preferredLanguage') || 'ro';
        languageSelector.value = preferredLanguage;
        updateUIForLanguage(preferredLanguage);
        
        // Relogare automata la refresh
        elvenJs.on('login', (address) => {
             handleLogin(address);
        });
        
        // Auto-reconnect pentru extensie
        setTimeout(() => {
          if (elvenJs.isLoggedIn()) {
            elvenJs.getAddress().then(address => {
              if (address) handleLogin(address);
            });
          }
        }, 1000);

    });
</script>


</body>
</html>
